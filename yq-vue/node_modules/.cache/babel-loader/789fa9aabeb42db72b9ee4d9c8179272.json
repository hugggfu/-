{"ast":null,"code":"export default {\n  name: \"Sign\",\n\n  data() {\n    return {\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\n    };\n  },\n\n  mounted() {\n    // 获取地理位置\n    var geolocation = new BMapGL.Geolocation();\n    geolocation.getCurrentPosition(function (r) {\n      if (this.getStatus() == BMAP_STATUS_SUCCESS) {\n        const province = r.address.province;\n        const city = r.address.city;\n        localStorage.setItem(\"location\", province + city);\n      }\n    });\n  },\n\n  methods: {\n    sign() {\n      const location = localStorage.getItem(\"location\");\n      const username = this.user.username;\n      this.request.post(\"/sign\", {\n        user: username,\n        location: location\n      }).then(res => {\n        if (res.code === '200') {\n          this.$message.success(\"打卡成功\");\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAwBA;EACAA,YADA;;EAEAC;IACA;MACAC;IADA;EAGA,CANA;;EAOAC;IAEA;IACA;IACAC;MACA;QACA;QACA;QACAC;MACA;IACA,CANA;EAOA,CAlBA;;EAoBAC;IACAC;MACA;MACA;MAEA;QAAAL;QAAAM;MAAA;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA,CANA;IAOA;;EAZA;AApBA","names":["name","data","user","mounted","geolocation","localStorage","methods","sign","location"],"sourceRoot":"src/views","sources":["Sign.vue"],"sourcesContent":["<template>\r\n  <div style=\"color: #666;font-size: 14px;\">\r\n    <div style=\"padding-bottom: 20px\">\r\n      <b>您好！{{ user.username }}</b>\r\n    </div>\r\n    <el-card>\r\n      欢迎使用本系统\r\n      <el-divider />\r\n      虎虎生威，虎年大吉\r\n    </el-card>\r\n\r\n    <el-card style=\"margin-top: 20px\">\r\n      <div style=\"margin: 20px 0; font-size: 20px\">{{ new Date().getFullYear() + '年' + (new Date().getMonth() + 1) + '月' + new Date().getDate() + '日' }}</div>\r\n      <div style=\"width: 200px; height: 200px; line-height: 200px; border-radius: 50%; background-color: #1E90FF;\r\n        font-size: 50px; color: #fff; text-align: center; cursor: pointer; box-shadow: 0 0 30px rgba(0, 0, 0, .2);\" @click=\"sign\">\r\n        打 卡\r\n      </div>\r\n    </el-card>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nexport default {\r\n  name: \"Sign\",\r\n  data() {\r\n    return {\r\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\r\n    }\r\n  },\r\n  mounted() {\r\n\r\n    // 获取地理位置\r\n    var geolocation = new BMapGL.Geolocation();\r\n    geolocation.getCurrentPosition(function(r){\r\n      if(this.getStatus() == BMAP_STATUS_SUCCESS){\r\n        const province = r.address.province\r\n        const city = r.address.city\r\n        localStorage.setItem(\"location\", province + city)\r\n      }\r\n    });\r\n  },\r\n\r\n  methods: {\r\n    sign() {\r\n      const location = localStorage.getItem(\"location\")\r\n      const username = this.user.username\r\n\r\n      this.request.post(\"/sign\", { user: username, location: location }).then(res => {\r\n        if (res.code === '200') {\r\n          this.$message.success(\"打卡成功\")\r\n        } else {\r\n          this.$message.error(res.msg)\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n"]},"metadata":{},"sourceType":"module"}